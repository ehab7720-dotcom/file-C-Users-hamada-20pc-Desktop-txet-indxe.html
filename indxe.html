<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام مصروفات الجناين 2 | حدائق القبة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* الأساسيات */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f8ff;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* الهيدر */
        header {
            background: linear-gradient(135deg, #1a5f7a, #2a9d8f);
            color: white;
            padding: 25px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: #a8dadc;
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .property-info {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .property-info p {
            margin-bottom: 5px;
        }
        
        /* قسم الدخول */
        .login-section {
            padding: 60px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }
        
        .login-box {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        
        .login-icon {
            font-size: 3rem;
            color: #1a5f7a;
            margin-bottom: 20px;
        }
        
        .login-box h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .login-box p {
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        
        .phone-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
            margin-bottom: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .phone-input:focus {
            border-color: #1a5f7a;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.2);
        }
        
        .submit-btn {
            background-color: #1a5f7a;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            background-color: #164863;
        }
        
        .error-message {
            color: #e63946;
            margin-top: 10px;
            display: none;
        }
        
        /* قسم اختيار التواجد */
        .presence-section {
            padding: 40px 0;
            display: none;
        }
        
        .presence-box {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        
        .presence-icon {
            font-size: 3rem;
            color: #1a5f7a;
            margin-bottom: 20px;
        }
        
        .presence-box h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .presence-box p {
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        
        .presence-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .presence-option {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            width: 200px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .presence-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .presence-option.selected {
            border-color: #1a5f7a;
            background-color: #e8f4f8;
        }
        
        .presence-option i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .present i {
            color: #2a9d8f;
        }
        
        .absent i {
            color: #e63946;
        }
        
        .presence-option h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .presence-option p {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        /* قسم المصروفات */
        .expenses-section {
            padding: 40px 0;
            display: none;
        }
        
        .owner-info {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .owner-details h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .owner-details p {
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .presence-status {
            background-color: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .presence-present {
            color: #2a9d8f;
            background-color: #e8f4f1;
        }
        
        .presence-absent {
            color: #e63946;
            background-color: #fde8e8;
        }
        
        .logout-btn {
            background-color: #e63946;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logout-btn:hover {
            background-color: #c1121f;
        }
        
        .monthly-charges {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .section-title {
            color: #1a5f7a;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a9d8f;
            font-size: 1.5rem;
        }
        
        .charges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .charge-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-right: 5px solid #1a5f7a;
        }
        
        .charge-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .charge-name i {
            color: #1a5f7a;
        }
        
        .charge-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2a9d8f;
        }
        
        .charge-details {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .total-section {
            background-color: #1a5f7a;
            color: white;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
        }
        
        .total-label {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .total-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: #a8dadc;
        }
        
        .payment-info {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .payment-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .payment-method {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        
        .payment-method i {
            font-size: 2rem;
            color: #1a5f7a;
            margin-bottom: 10px;
        }
        
        /* الفوتر */
        footer {
            background-color: #1a5f7a;
            color: white;
            padding: 30px 0;
            margin-top: 50px;
            text-align: center;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .contact-info {
            text-align: right;
        }
        
        .contact-info h4 {
            margin-bottom: 10px;
            color: #a8dadc;
        }
        
        .copyright {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* التجاوب مع الشاشات */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .property-info {
                width: 100%;
            }
            
            .login-box, .presence-box {
                padding: 30px 20px;
            }
            
            .presence-options {
                flex-direction: column;
                align-items: center;
            }
            
            .presence-option {
                width: 100%;
                max-width: 300px;
            }
            
            .owner-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .contact-info {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- الهيدر -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-area">
                    <i class="fas fa-building logo-icon"></i>
                    <div class="logo-text">
                        <h1>عقار الجناين 2 - حدائق القبة</h1>
                        <p>نظام تحصيل المصروفات الشهرية</p>
                    </div>
                </div>
                <div class="property-info">
                    <p><i class="fas fa-home"></i> عدد الشقق: 24 شقة</p>
                    <p><i class="fas fa-calendar-alt"></i> الشهر: <span id="current-month"></span></p>
                </div>
            </div>
        </div>
    </header>

    <!-- قسم الدخول -->
    <section class="login-section" id="loginSection">
        <div class="container">
            <div class="login-box">
                <i class="fas fa-key login-icon"></i>
                <h2>الدخول إلى النظام</h2>
                <p>يرجى إدخال رقم هاتفك المسجل في إدارة العقار للاطلاع على المبالغ المستحقة</p>
                
                <form id="loginForm">
                    <input type="tel" class="phone-input" id="phoneNumber" placeholder="أدخل رقم الهاتف (مثال: 01272064866)" required>
                    <button type="submit" class="submit-btn">الدخول إلى النظام</button>
                </form>
                
                <div class="error-message" id="errorMessage">
                    رقم الهاتف غير مسجل في النظام. يرجى التأكد من الرقم والمحاولة مرة أخرى.
                </div>
                
                <div style="margin-top: 20px; color: #7f8c8d; font-size: 0.9rem;">
                    <p>ملاحظة: رقم الهاتف يجب أن يكون مسجلاً في سجلات إدارة العقار</p>
                </div>
            </div>
        </div>
    </section>

    <!-- قسم اختيار التواجد -->
    <section class="presence-section" id="presenceSection">
        <div class="container">
            <div class="presence-box">
                <i class="fas fa-user-check presence-icon"></i>
                <h2>حالة التواجد في العقار</h2>
                <p>مرحباً <span id="ownerNamePresence"></span>، يرجى تحديد حالة تواجدك في العقار هذا الشهر:</p>
                
                <div class="presence-options">
                    <div class="presence-option present" id="presentOption">
                        <i class="fas fa-home"></i>
                        <h3>متواجد</h3>
                        <p>أنا مقيم في الشقة حالياً</p>
                    </div>
                    
                    <div class="presence-option absent" id="absentOption">
                        <i class="fas fa-plane"></i>
                        <h3>غير متواجد</h3>
                        <p>أنا غير مقيم في الشقة حالياً</p>
                    </div>
                </div>
                
                <div id="presenceDescription" style="margin-bottom: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; display: none;">
                    <p id="descriptionText"></p>
                </div>
                
                <button class="submit-btn" id="confirmPresenceBtn" style="display: none;">
                    تأكيد ومتابعة
                </button>
            </div>
        </div>
    </section>

    <!-- قسم المصروفات (سيظهر بعد الدخول) -->
    <section class="expenses-section" id="expensesSection">
        <div class="container">
            <!-- معلومات المالك -->
            <div class="owner-info">
                <div class="owner-details">
                    <h3>مرحباً، <span id="ownerName"></span></h3>
                    <p>رقم الهاتف: <span id="ownerPhone"></span></p>
                    <p>الشقة رقم: <span id="apartmentNumber"></span> - <span id="apartmentLocation"></span></p>
                    <p>المكان: <span id="fullLocation"></span></p>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 10px; align-items: center;">
                    <div class="presence-status" id="presenceStatusDisplay">
                        <!-- سيتم تعبئته بالجافاسكربت -->
                    </div>
                    
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                    </button>
                </div>
            </div>
            
            <!-- تفاصيل المصروفات -->
            <div class="monthly-charges">
                <h2 class="section-title">المصروفات الشهرية المستحقة</h2>
                
                <div class="charges-grid" id="chargesGrid">
                    <!-- سيتم تعبئته بالجافاسكربت -->
                </div>
                
                <!-- الإجمالي -->
                <div class="total-section">
                    <div class="total-label">إجمالي المبلغ الشهري المستحق:</div>
                    <div class="total-amount" id="totalAmount">0 جنيه</div>
                    <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                        <p id="totalDescription">يتم تحصيل هذا المبلغ شهرياً من كل مالك شقة</p>
                    </div>
                </div>
            </div>
            
            <!-- معلومات الدفع -->
            <div class="payment-info">
                <h2 class="section-title">طرق السداد المتاحة</h2>
                <p>يمكنك سداد المبلغ المستحق بأي من الطرق التالية:</p>
                
                <div class="payment-methods">
                    <div class="payment-method">
                        <i class="fas fa-money-bill-wave"></i>
                        <h4>الدفع النقدي</h4>
                        <p>التسليم يدوياً لإدارة العقار</p>
                        <p>المسؤول: أ / سيف</p>
                    </div>
                    
                    <div class="payment-method">
                        <i class="fas fa-mobile-alt"></i>
                        <h4>التحويل البنكي</h4>
                        <p>البنك الأهلي المصري</p>
                        <p>رقم الحساب: 0000000</p>
                    </div>
                    
                    <div class="payment-method">
                        <i class="fas fa-qrcode"></i>
                        <h4>الدفع الإلكتروني</h4>
                        <p>عن طريق كود الدفع الإلكتروني</p>
                        <p>كود الدفع: GN2-<span id="apartmentCode"></span></p>
                    </div>
                </div>
                
                <div style="margin-top: 25px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                    <h4><i class="fas fa-info-circle" style="color: #1a5f7a;"></i> ملاحظات هامة:</h4>
                    <ul style="margin-top: 10px; padding-right: 20px;">
                        <li>يرجى السداد خلال أول 10 أيام من كل شهر</li>
                        <li>في حال التأخير، سيتم تطبيق غرامة تأخير 5% من المبلغ</li>
                        <li>للاستفسارات: يرجى الاتصال بإدارة العقار على 01206317474</li>
                        <li>المسؤول عن إدارة العقار: أ / سيف (01206317474)</li>
                        <li>شكراً لتعاونكم في دفع المصروفات في موعدها</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- الفوتر -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="logo-area">
                    <i class="fas fa-building logo-icon"></i>
                    <div class="logo-text">
                        <h3>عقار الجناين 2 - حدائق القبة</h3>
                        <p>نظام إدارة المصروفات الشهرية</p>
                    </div>
                </div>
                
                <div class="contact-info">
                    <h4>اتصل بنا</h4>
                    <p><i class="fas fa-phone"></i> إدارة العقار: 01206317474</p>
                    <p><i class="fas fa-user-hard-hat"></i> المسؤول: أ / سيف</p>
                    <p><i class="fas fa-map-marker-alt"></i> حدائق القبة، القاهرة</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>جميع الحقوق محفوظة &copy; <span id="currentYear"></span> | نظام تحصيل المصروفات الشهرية للعقار</p>
                <p style="margin-top: 10px; font-size: 0.8rem;">تم التطوير خصيصاً لإدارة عقار الجناين 2 - حدائق القبة</p>
            </div>
        </div>
    </footer>

    <script>
        // قاعدة بيانات الملاك الحقيقية - تم إصلاحها
        const ownersData = {
            "01272064866": { 
                name: "ا/عبد الحي شمس الدين", 
                apartment: "1",
                location: "الدور الاول يمين السلم"
            },
            "01225344772": { 
                name: "ا / نيفين ابراهيم سيدهم", 
                apartment: "2",
                location: "الدور الاول يسار السلم"
            },
            "01096990037": { 
                name: "م /نعمات محمد عبد الرحمن", 
                apartment: "3",
                location: "الدور الثاني يمين السلم"
            },
            "01222350220": { 
                name: "م سهير عياد رؤفائيل", 
                apartment: "4",
                location: "الدور الثاني يسار السلم"
            },
            "01285728517": { 
                name: "ا / سامح فؤاد وهبه", 
                apartment: "5",
                location: "الدور الثالث يمين السلم"
            },
            "01066321803": { 
                name: "ا/ حمدي محمد احمد حسن", 
                apartment: "6",
                location: "الدور الثالث يسار السلم"
            },
            "01206317474": { 
                name: "ا / محمد سيف", 
                apartment: "7",
                location: "الدور الرابع يمين السلم"
            },
            "01282620622": { 
                name: "ا / مينا سمير رمسيس", 
                apartment: "8",
                location: "الدور الرابع يسار السلم"
            },
            "01272588115": { 
                name: "ا / بشوي عماد", 
                apartment: "9",
                location: "الدور الخامس يمين السلم"
            },
            "01005106476": { 
                name: "د / رانيا حليم غالي معوض", 
                apartment: "10",
                location: "الدور الخامس يسار السلم"
            },
            "01227818120": { 
                name: "ا / احمد محمد حسن", 
                apartment: "11",
                location: "الدور السادس يمين السلم"
            },
            "01202688221": { 
                name: "ا / كرولس ابراهيم سعد", 
                apartment: "12",
                location: "الدور السادس يسار السلم"
            },
            "01067726239": { 
                name: "ا/ سامح الفي ناشد", 
                apartment: "13",
                location: "الدور السابع يمين السلم"
            },
            "01005208067": { 
                name: "ا / جورج وفقي مقار", 
                apartment: "14",
                location: "الدور السابع يسار السلم"
            },
            "01220002216": { 
                name: "م / عبد الحميد ابراهيم عبد الحميد", 
                apartment: "15",
                location: "الدور الثامن يمين السلم"
            },
            "01551287370": { 
                name: "ا / اثناثيوس ابراهيم سعد", 
                apartment: "16",
                location: "الدور الثامن يسار السلم"
            },
            "01280514835": { 
                name: "ا / شنوده عبد القدوس جاد", 
                apartment: "17",
                location: "الدور التاسع يمين السلم"
            },
            "01090071583": { 
                name: "ا / محمد علي محمد الجمل", 
                apartment: "18",
                location: "الدور التاسع يسار السلم"
            },
            "01122250606": { 
                name: "ا / حسين احمد شاكر", 
                apartment: "19",
                location: "الدور العاشر يمين السلم"
            },
            "01211145422": { 
                name: "ا / مرقس زكي بشاي", 
                apartment: "20",
                location: "الدور العاشر يسار السلم"
            },
            "01210055231": { 
                name: "د / نادي يسى طانيوس", 
                apartment: "21",
                location: "الحادي عشر يمين السلم"
            },
            "01282247921": { 
                name: "ا / جورج جرجس كاراس", 
                apartment: "22",
                location: "الحادي عشر يسار السلم"
            },
            "01064011315": { 
                name: "ا / محمد احمد محمد حسان", 
                apartment: "23",
                location: "الثاني عشر يمين السلم"
            },
            "01026138582": { 
                name: "ا / زينب سعد علي عبد الحميد", 
                apartment: "24",
                location: "الثاني عشر يسار السلم"
            }
        };
        
        // تعريف المصروفات المعدلة
        const expenses = {
            present: {
                electricity: { name: "كهرباء", amount: 230, icon: "fas fa-bolt" },
                water: { name: "مياه", amount: 100, icon: "fas fa-tint" },
                guard: { name: "حارس أمن", amount: 100, icon: "fas fa-shield-alt" },
                elevator: { name: "مصعد", amount: 20, icon: "fas fa-elevator" },
                emergency: { name: "طوارئ", amount: 15, icon: "fas fa-exclamation-triangle" }
            },
            absent: {
                electricity: { name: "كهرباء", amount: 60, icon: "fas fa-bolt" },
                water: { name: "مياه", amount: 60, icon: "fas fa-tint" },
                guard: { name: "حارس أمن", amount: 100, icon: "fas fa-shield-alt" },
                elevator: { name: "مصعد", amount: 10, icon: "fas fa-elevator" }
            }
        };
        
        // العناصر الأساسية في الصفحة
        const loginSection = document.getElementById('loginSection');
        const presenceSection = document.getElementById('presenceSection');
        const expensesSection = document.getElementById('expensesSection');
        const loginForm = document.getElementById('loginForm');
        const phoneInput = document.getElementById('phoneNumber');
        const errorMessage = document.getElementById('errorMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        const ownerNameElement = document.getElementById('ownerName');
        const ownerNamePresenceElement = document.getElementById('ownerNamePresence');
        const ownerPhoneElement = document.getElementById('ownerPhone');
        const apartmentNumberElement = document.getElementById('apartmentNumber');
        const apartmentLocationElement = document.getElementById('apartmentLocation');
        const fullLocationElement = document.getElementById('fullLocation');
        const apartmentCodeElement = document.getElementById('apartmentCode');
        const currentMonthElement = document.getElementById('current-month');
        const currentYearElement = document.getElementById('currentYear');
        const chargesGridElement = document.getElementById('chargesGrid');
        const totalAmountElement = document.getElementById('totalAmount');
        const totalDescriptionElement = document.getElementById('totalDescription');
        const presenceStatusDisplay = document.getElementById('presenceStatusDisplay');
        
        // عناصر قسم التواجد
        const presentOption = document.getElementById('presentOption');
        const absentOption = document.getElementById('absentOption');
        const presenceDescription = document.getElementById('presenceDescription');
        const descriptionText = document.getElementById('descriptionText');
        const confirmPresenceBtn = document.getElementById('confirmPresenceBtn');
        
        // متغيرات النظام
        let currentOwner = null;
        let ownerPresence = null; // 'present' أو 'absent'
        
        // تحديث التاريخ الحالي
        function updateCurrentDate() {
            const now = new Date();
            const months = [
                "يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو",
                "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"
            ];
            
            currentMonthElement.textContent = months[now.getMonth()] + " " + now.getFullYear();
            currentYearElement.textContent = now.getFullYear();
        }
        
        // معالجة تسجيل الدخول
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            let phoneNumber = phoneInput.value.trim();
            
            // تنظيف رقم الهاتف - إزالة المسافات والرموز
            phoneNumber = phoneNumber.replace(/\s+/g, ''); // إزالة المسافات
            phoneNumber = phoneNumber.replace(/[^0-9]/g, ''); // إزالة كل ما ليس رقم
            
            // إذا بدأ بـ 0 نأخذ آخر 11 رقم، وإذا بدأ بـ 2 نأخذ آخر 10 أرقام
            if (phoneNumber.startsWith('0')) {
                phoneNumber = phoneNumber.substring(0, 11);
            } else if (phoneNumber.startsWith('2')) {
                phoneNumber = phoneNumber.substring(0, 10);
            }
            
            console.log("رقم الهاتف المدخل بعد التنظيف:", phoneNumber);
            
            if (phoneNumber === "") {
                showError("يرجى إدخال رقم الهاتف");
                return;
            }
            
            // التحقق من رقم الهاتف بعدة طرق
            let foundOwner = null;
            
            // الطريقة 1: البحث بالمطابقة الكاملة
            if (ownersData[phoneNumber]) {
                foundOwner = ownersData[phoneNumber];
            }
            // الطريقة 2: البحث بـ 0 في البداية
            else if (phoneNumber.startsWith('0') && ownersData[phoneNumber.substring(1)]) {
                foundOwner = ownersData[phoneNumber.substring(1)];
            }
            // الطريقة 3: البحث بدون 0 في البداية
            else if (!phoneNumber.startsWith('0') && ownersData['0' + phoneNumber]) {
                foundOwner = ownersData['0' + phoneNumber];
            }
            
            if (foundOwner) {
                // نجاح الدخول
                currentOwner = foundOwner;
                ownerNamePresenceElement.textContent = currentOwner.name;
                
                // إخفاء قسم الدخول وإظهار قسم اختيار التواجد
                loginSection.style.display = 'none';
                presenceSection.style.display = 'block';
                errorMessage.style.display = 'none';
                
                // حفظ حالة الدخول
                sessionStorage.setItem('loggedIn', 'true');
                sessionStorage.setItem('phoneNumber', phoneNumber);
                
                // إعادة تعيين حالة التواجد
                ownerPresence = null;
                resetPresenceOptions();
            } else {
                // فشل الدخول
                showError("رقم الهاتف غير مسجل في النظام. يرجى التأكد من الرقم والمحاولة مرة أخرى.");
                
                // عرض أرقام الهواتف المسجلة للمساعدة في التصحيح
                console.log("الأرقام المسجلة في النظام:", Object.keys(ownersData));
            }
        });
        
        // إعادة تعيين خيارات التواجد
        function resetPresenceOptions() {
            presentOption.classList.remove('selected');
            absentOption.classList.remove('selected');
            presenceDescription.style.display = 'none';
            confirmPresenceBtn.style.display = 'none';
        }
        
        // اختيار خيار التواجد
        presentOption.addEventListener('click', function() {
            presentOption.classList.add('selected');
            absentOption.classList.remove('selected');
            ownerPresence = 'present';
            
            descriptionText.textContent = "ستظهر لك المصروفات الكاملة (كهرباء 230 + مياه 100 + حارس 100 + مصعد 20 + طوارئ 15) = 465 جنيه";
            presenceDescription.style.display = 'block';
            confirmPresenceBtn.style.display = 'block';
        });
        
        absentOption.addEventListener('click', function() {
            absentOption.classList.add('selected');
            presentOption.classList.remove('selected');
            ownerPresence = 'absent';
            
            descriptionText.textContent = "ستظهر لك المصروفات المخفضة (كهرباء 60 + مياه 60 + حارس 100 + مصعد 10) = 230 جنيه";
            presenceDescription.style.display = 'block';
            confirmPresenceBtn.style.display = 'block';
        });
        
        // تأكيد خيار التواجد
        confirmPresenceBtn.addEventListener('click', function() {
            if (!ownerPresence) {
                alert("يرجى اختيار حالة التواجد أولاً");
                return;
            }
            
            // تعبئة معلومات المالك
            ownerNameElement.textContent = currentOwner.name;
            ownerPhoneElement.textContent = phoneInput.value.trim();
            apartmentNumberElement.textContent = currentOwner.apartment;
            
            // تحديد موقع الشقة بالتفصيل
            let locationText = currentOwner.location;
            if (locationText.includes("يمين")) {
                apartmentLocationElement.textContent = "يمين السلم";
            } else if (locationText.includes("يسار")) {
                apartmentLocationElement.textContent = "يسار السلم";
            } else {
                apartmentLocationElement.textContent = locationText;
            }
            
            fullLocationElement.textContent = currentOwner.location;
            apartmentCodeElement.textContent = currentOwner.apartment;
            
            // تعبئة المصروفات حسب حالة التواجد
            displayExpenses(ownerPresence);
            
            // إخفاء قسم التواجد وإظهار قسم المصروفات
            presenceSection.style.display = 'none';
            expensesSection.style.display = 'block';
            
            // حفظ حالة التواجد
            sessionStorage.setItem('ownerPresence', ownerPresence);
        });
        
        // عرض المصروفات حسب حالة التواجد
        function displayExpenses(presence) {
            // إفراغ الشبكة الحالية
            chargesGridElement.innerHTML = '';
            
            let selectedExpenses = expenses[presence];
            let total = 0;
            
            // إضافة كل مصروف
            for (const [key, expense] of Object.entries(selectedExpenses)) {
                const chargeItem = document.createElement('div');
                chargeItem.className = 'charge-item';
                chargeItem.innerHTML = `
                    <div class="charge-name">
                        <i class="${expense.icon}"></i> ${expense.name}
                    </div>
                    <div class="charge-amount">${expense.amount} جنيه</div>
                    <div class="charge-details">${getExpenseDescription(key, presence)}</div>
                `;
                
                chargesGridElement.appendChild(chargeItem);
                total += expense.amount;
            }
            
            // تحديث الإجمالي
            totalAmountElement.textContent = total + " جنيه";
            
            // تحديث وصف الإجمالي
            if (presence === 'present') {
                totalDescriptionElement.textContent = "إجمالي المصروفات الكاملة للشقة المشغولة";
                presenceStatusDisplay.innerHTML = '<span class="presence-present"><i class="fas fa-home"></i> متواجد في العقار</span>';
            } else {
                totalDescriptionElement.textContent = "إجمالي المصروفات المخفضة للشقة غير المشغولة";
                presenceStatusDisplay.innerHTML = '<span class="presence-absent"><i class="fas fa-plane"></i> غير متواجد في العقار</span>';
            }
        }
        
        // الحصول على وصف المصروف
        function getExpenseDescription(expenseKey, presence) {
            const descriptions = {
                electricity: {
                    present: "استهلاك الكهرباء المشترك للعقار (سعر كامل)",
                    absent: "استهلاك الكهرباء الأساسي للشقة (سعر مخفض)"
                },
                water: {
                    present: "استهلاك المياه المشترك للعقار (سعر كامل)",
                    absent: "استهلاك المياه الأساسي للشقة (سعر مخفض)"
                },
                guard: "مصاريف حارس الأمن الشهرية (ثابت)",
                elevator: {
                    present: "صيانة وتشغيل المصعد (سعر كامل)",
                    absent: "صيانة وتشغيل المصعد (سعر مخفض)"
                },
                emergency: "صندوق طوارئ للصيانة العاجلة"
            };
            
            if (expenseKey === 'guard') return descriptions.guard;
            if (expenseKey === 'emergency') return descriptions.emergency;
            
            return descriptions[expenseKey][presence];
        }
        
        // وظيفة عرض رسالة الخطأ
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            phoneInput.style.borderColor = '#e63946';
            
            // إخفاء رسالة الخطأ بعد 5 ثواني
            setTimeout(() => {
                errorMessage.style.display = 'none';
                phoneInput.style.borderColor = '#ddd';
            }, 5000);
        }
        
        // تسجيل الخروج
        logoutBtn.addEventListener('click', function() {
            // إعادة عرض قسم الدخول وإخفاء الأقسام الأخرى
            loginSection.style.display = 'flex';
            presenceSection.style.display = 'none';
            expensesSection.style.display = 'none';
            
            // مسح بيانات الدخول
            phoneInput.value = '';
            currentOwner = null;
            ownerPresence = null;
            sessionStorage.removeItem('loggedIn');
            sessionStorage.removeItem('phoneNumber');
            sessionStorage.removeItem('ownerPresence');
            
            // إعادة تعيين النموذج
            loginForm.reset();
        });
        
        // التحقق من حالة الدخول السابقة
        window.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            
            const loggedIn = sessionStorage.getItem('loggedIn');
            const phoneNumber = sessionStorage.getItem('phoneNumber');
            const savedPresence = sessionStorage.getItem('ownerPresence');
            
            if (loggedIn === 'true' && phoneNumber) {
                // تنظيف رقم الهاتف المحفوظ
                let cleanPhoneNumber = phoneNumber.replace(/\s+/g, '').replace(/[^0-9]/g, '');
                
                // البحث عن المالك
                let foundOwner = null;
                
                if (ownersData[cleanPhoneNumber]) {
                    foundOwner = ownersData[cleanPhoneNumber];
                } else if (cleanPhoneNumber.startsWith('0') && ownersData[cleanPhoneNumber.substring(1)]) {
                    foundOwner = ownersData[cleanPhoneNumber.substring(1)];
                } else if (!cleanPhoneNumber.startsWith('0') && ownersData['0' + cleanPhoneNumber]) {
                    foundOwner = ownersData['0' + cleanPhoneNumber];
                }
                
                if (foundOwner) {
                    currentOwner = foundOwner;
                    
                    if (savedPresence) {
                        // يوجد حالة تواجد محفوظة، عرض قسم المصروفات مباشرة
                        ownerPresence = savedPresence;
                        ownerNameElement.textContent = currentOwner.name;
                        ownerPhoneElement.textContent = phoneNumber;
                        apartmentNumberElement.textContent = currentOwner.apartment;
                        
                        // تحديد موقع الشقة
                        let locationText = currentOwner.location;
                        if (locationText.includes("يمين")) {
                            apartmentLocationElement.textContent = "يمين السلم";
                        } else if (locationText.includes("يسار")) {
                            apartmentLocationElement.textContent = "يسار السلم";
                        } else {
                            apartmentLocationElement.textContent = locationText;
                        }
                        
                        fullLocationElement.textContent = currentOwner.location;
                        apartmentCodeElement.textContent = currentOwner.apartment;
                        
                        displayExpenses(savedPresence);
                        
                        loginSection.style.display = 'none';
                        presenceSection.style.display = 'none';
                        expensesSection.style.display = 'block';
                    } else {
                        // لا يوجد حالة تواجد محفوظة، عرض قسم اختيار التواجد
                        ownerNamePresenceElement.textContent = currentOwner.name;
                        
                        loginSection.style.display = 'none';
                        presenceSection.style.display = 'block';
                        expensesSection.style.display = 'none';
                    }
                } else {
                    // المستخدم غير مسجل دخوله
                    loginSection.style.display = 'flex';
                    presenceSection.style.display = 'none';
                    expensesSection.style.display = 'none';
                }
            } else {
                // المستخدم غير مسجل دخوله
                loginSection.style.display = 'flex';
                presenceSection.style.display = 'none';
                expensesSection.style.display = 'none';
            }
            
            // إضافة نمط للأرقام المدخلة
            phoneInput.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9+]/g, '');
            });
        });
    </script>
</body>
</html>